var x$;x$=angular.module("main",[]),x$.controller("main",["$scope","$http"].concat(function(e){return e.target={name:"新北市三峽區安坑里"},e.openWidget=function(){return e.toggleWidget=!e.toggleWidget},console.log("loading..."),d3.json("geodata.json",function(t){var o,r,n,a,c,l,i,g,p,s,u,d;return e.topo=t,o={village:topojson.feature(t.village,t.village.objects["10402村里界(WGS84經緯度)"]).features,town:topojson.feature(t.town,t.town.objects["鄉鎮界(經緯度)1031225_big5"]).features},o.all=o.village.concat(o.town),e.projection=r=d3.geo.mercator().center([121.553243,24.926172]).scale(5e4),n=d3.geo.path().projection(r),a={3:"週五、週六限水",1:"週一、週二限水",2:"週三、週四限水"},c=function(t){return e.target.type=a[t]},l=function(t){return e.$apply(function(){var o;return o=t.properties,e.target.name=o.C_Name+""+o.T_Name+(o.V_Name||""),c(o.category),e.target.comment=(o.comment||[]).join(" / ")})},d3.select("svg g#geoblock").selectAll("path").data(o.all).enter().append("path"),d3.select("svg g#clickblock").selectAll("path").data(o.all).enter().append("path"),i=function(e,t){var o;return null==t&&(t=!1),o=e,o.style({cursor:"pointer"}),o.attr({d:n,opacity:function(){return t?"0.01":1},fill:function(e){return"3"===e.properties.category?"#802e23":"1"===e.properties.category?"#48762e":"2"===e.properties.category?"#b5878b":"#999"},stroke:function(e){return"3"===e.properties.category?"#a04e43":"1"===e.properties.category?"#68964e":"2"===e.properties.category?"#d5a7ab":void 0}}),o.on("click",l),o.on("mousemove",l),o},i(d3.select("svg g#geoblock").selectAll("path")),i(d3.select("svg g#clickblock").selectAll("path"),!0),e["goto"]=function(){var t;return t=new google.maps.Geocoder,t.geocode({address:e.address},function(t,o){var r,n,a,c;return o===google.maps.GeocoderStatus.OK?(r=function(e){return[e.lng(),e.lat()]}(t[0].geometry.location),n=e.projection(r),a=n[0],c=n[1],d3.select("#marker").transition().duration(300).attr({x:a-16,y:c-45})):void 0}),e.toggleWidget=!1},g=e.projection([121.480705,25.038353]),p=g[0],s=g[1],g=e.projection([121.485511,24.994486]),u=g[0],d=g[1],e.$apply(function(){return e.m={x:p,y:s}}),e.$apply(function(){return e.m2={x:u,y:d}}),c(1)})}));